import api from './api';
import { Job } from '@/types';

export interface MatchedJob {
  job: Job;
  match_score: number;
  explanation: string;
  collar_type: string;
  components: {
    qualification: number;
    experience: number;
    skills: number;
    location: number;
  };
}

export interface CollarAwareMatchResult {
  user_id: number;
  matches: MatchedJob[];
  total_jobs_scored: number;
}

export interface JobMatchScore {
  match_score: number;
  explanation: string;
  collar_type: string;
  components: {
    qualification: number;
    experience: number;
    skills: number;
    location: number;
  };
  user_id: number;
  job_id: number;
}

/**
 * Get AI-matched jobs for the current user using CAMSS
 * @param topK - Number of top matches to return (default: 10)
 */
export const getAIMatchedJobs = async (topK: number = 10): Promise<CollarAwareMatchResult> => {
  const response = await api.get(`/match/ai/jobs?top_k=${topK}`);
  return response.data;
};

/**
 * Get match score for a specific job
 * @param jobId - The job ID to get match score for
 */
export const getJobMatchScore = async (jobId: number): Promise<JobMatchScore> => {
  const response = await api.get(`/match/ai/job/${jobId}`);
  return response.data;
};

/**
 * Get job details with match score
 * @param jobId - The job ID
 */
export const getJobWithMatchScore = async (jobId: number) => {
  const response = await api.get(`/jobs/${jobId}/match`);
  return response.data;
};

/**
 * Debug endpoint - Test matching with sample data
 */
export const debugMatchSample = async () => {
  const response = await api.get('/match/debug/sample');
  return response.data;
};

export const matchService = {
  getAIMatchedJobs,
  getJobMatchScore,
  getJobWithMatchScore,
  debugMatchSample,
};
